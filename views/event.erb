<!DOCTYPE html>
<html>

<%= erb :"assets/head" %>

<body class="event_page">
<!-- if event exists -->
<% if @event.info.length > 0 %>
<%= erb :"assets/header" %>
	<div class="page_body">	
		
		<div class="event">	
			<h2><%= @event.info['title'] %> (<%= @event.info['date'] %>)</h2>
			<hr>
			<div class="event_details">
			<form action="/">
				<input type="submit" value="Go To Events"/>
			</form>
				<ul>
					<li><%= @event.info['group'] %></li>
					<li><%= @event.info['time'] %></li>
					<li><%= @event.info['location'] %> @ <%= @event.info['address'] %></li>
					<li>
						<a href = <%= @event.info['link'].to_s %>>
							Original Page.
						</a>
					</li>
				</ul>	
			</div>
		</div>
		<div class="reservations">
			<h2>Attendees</h2>
			<!-- user is logged in -->
			<% if session[:user] %>
				<!-- prevents rsvp on past events -->
				<% if Time.parse(@event.info["date"] + ' ' + @event.info["time"]).to_i > Time.now.to_i %>
					<div class="rsvp-actions">
						<form class="rsvp-button" action="/addAttendee" method="post">
							<input type="hidden" name="eventId" value=<%= @event.info["id"] %> readonly >
							<input type="submit" value="RSVP!">
						</form>
						<form class="rsvp-button" action="/deleteRsvp" method="post">
							<input type="hidden" name="eventId" value=<%= @event.info["id"] %> readonly>
							<input type='submit' value="Remove RSVP">		
						</form>
					</div>
				<% else %>
					<p>this event has passed</p>
				<% end %>
			<!-- user is not logged in -->
			<% else %>
				<p> Please register to RSVP </p>
			<% end %>
			<hr>
			<div class="attendies">
				<ul>
					<% @event.getFromDatabase("rsvps").each do |name| %>
					<%= "<li>" + name["fullname"] + "<br>" + "</li>"%> 
					<% end %> 
				</ul>
			</div>
		</div>

		<div class="comments">
			<h2>Comments</h2><br>
			<% @event.getFromDatabase("comments").each do |comment| %>
				<%= "<div class='eachcomments'><span class='comment-name'>" + comment["fullname"] + "</span> " + 
				"<span class='comment-text'>" + comment["comment"] + "</span> " %>

				<% if session[:user] %>
					<% if comment['fullname'] == session[:user]['fullname'] && (Time.now.to_i - comment['timestamp'].to_i) < 1800 %>
						<button class="editComment" id=<%= comment["commentid"] %>>edit</button>
				    <% end %> 
				<% end %>    
			    </div>
			<% end %> 
			<% if session[:user] %>
			<form action="/comments" method="post">
				<textarea class="commentInput" name='comment'></textarea><br>
				<input type="hidden" name="eventId" value=<%= @event.info["id"] %>>
				<input type='submit' value="post comment">	
			</form>
			<% else %>
			<p class="login-to-comment">please login to comment</p>
			<% end %>
		</div>

			    <!-- The Modal -->
		<div class="modal">
		    <div class="modal_body">
	        	<form class="comment_edit" action="/editComment" method="post">
					<textarea class="editText" name="textContent"></textarea><br>
					<input type="hidden" name="eventId" value=<%= @event.info["id"] %>>
					<input class="commentId" type="hidden" name="commentId" value="">
					<button class="cancel">submit</button>
					<button class="exit">cancel</button>
				</form>
		    </div>
		</div>

	</div>
<!-- if event doesnt exist -->
<% else %>
	<h1>Bzzt! ERROR! No event under this id.</h1>
<% end %>

</body>
</html>


