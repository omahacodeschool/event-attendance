<!DOCTYPE html>
<html>

<%= erb :"assets/head" %>

<body class="event_page">
<!-- if event exists -->
<% if @event.info.length > 0 %>
<%= erb :"assets/header" %>
	<div class="page_body">	

	<form class="Button events-nav" action="/">
		<button type="submit">Back to Events</button>
	</form>
		
		<div class="event info">	
			<h2><%= @event.info['title'] %> (<%= @event.info['date'] %>)</h2>
			<div class="event_details">
				<ul>
					<li>Who: <%= @event.info['group'] %></li>
					<li>When: <%= @event.info['time'] %></li>
					<li>Where: <%= @event.info['location'] %> @ <%= @event.info['address'] %></li>
					<li>
						<a href = <%= @event.info['link'].to_s %>>
							Original Page.
						</a>
					</li>
				</ul>	
			</div>
		</div>
		<div class="reservations info">
			<h2>Attendees (<%= @event.attendees.length %>)</h2>
			<!-- user is logged in -->
			<% if session[:user] %>
				<div class="rsvp-actions">
					<form class="rsvp-button" action="/addAttendee" method="post">
						<input type="hidden" name="eventId" value=<%= @event.info["id"] %> readonly >
						<button type="submit"> RSVP! </button>
					</form>
					<form class="rsvp-button" action="/deleteRsvp" method="post">
						<input type="hidden" name="eventId" value=<%= @event.info["id"] %> readonly>
						<button type='submit'> Remove RSVP </button>
					</form>
				</div>
			<!-- user is not logged in -->
			<% else %>
				<p> Please register or sign in to RSVP </p>
			<% end %>
			<div class="attendees">
				<ul>
					<% @event.attendees.each do |name| %>
					<%= "<li>" + name["fullname"] + "<br>" + "</li>"%> 
					<% end %> 
				</ul>
			</div>
		</div>

		<div class="comments info">
			<h2>Comments (<%= @event.comments.length %>)</h2><br>
			<% @event.comments.each do |comment| %>
				<%= "<div class='eachcomments'><span class='comment-name'>" + comment["fullname"] + "</span> " + 
				"<span class='comment-text'>" + comment["comment"] + "</span> " +
				"<span class='comment-id'>" + comment["commentid"] + "</span> "%>

				<% if comment['fullname'] == session[:user]['fullname'] %>
					<form class="delete-comment" action="/comment-delete" method="post">
						<button name="edit_comment">edit</button>
					</form>
			   <% end %>
			   </div>
			<% end %> 


			<form action="/comments" method="post">
				<textarea class="commentInput" name='comment'></textarea><br>
				<input type="hidden" name="eventId" value=<%= @event.info["id"] %>>
				<button type='submit'>post comment</button>
			</form>
		</div>

	</div>
<!-- if event doesnt exist -->
<% else %>
	<h1>Bzzt! ERROR! No event under this id.</h1>
<% end %>

</body>
</html>


